#!/usr/bin/env python3

texts = {
	"HEADER_START": """/* This file has been generated by flow2code
* See: https://flow.liwe.org
*/

import { ILRequest, ILResponse, ILError, ILiWE } from '../../liwe/types';
import { send_error, send_ok, typed_dict } from "../../liwe/utils";
import { locale_load } from '../../liwe/locale';

import { perms } from '../../liwe/auth';

import {
	%(_methods)s
} from './methods';

import {
	User, UserActivationCode, UserFaceRec, UserPerms, UserRegistration, UserSessionData
} from './types';

// d2r_start __header
%(__header)s
// d2r_end __header

export const init = ( liwe: ILiWE ) => {
	const app = liwe.app;

	console.log( "    - %(__name_camel)s " );

	liwe.cfg.app.languages.map( ( l ) => locale_load( "%(__name_lower)s", l ) );
	user_db_init ( liwe );
""",

	"ENDPOINT": """
	app.%(__method_lower)s ( '/api%(url)s', %(__perms)s ( req: ILRequest, res: ILResponse ) => {
		%(__typed_dict)s

		%(__endpoint_name)s ( %(__params)s ( err: ILError, user: User ) => {
			if ( err ) return send_error( res, err );

			send_ok( res, { user } );
		} );
	} );
""",
		"TYPED_DICT": '{ name: "%(name)s", type: "%(type)s"%(_req_param)s }',
		"TYPED_DICT_OBJ": '{ name: "%(name)s", type: %(type)sObj%(_req_param)s }',
}